{
    "collab_server" : "",
    "contents" : "install.packages(\"tidyr\")\ninstall.packages(\"httr\")\ninstall.packages(\"RCurl\")\ninstall.packages(\"XML\")\ninstall.packages(\"bitops\")\ninstall.packages(\"magrittr\")\ninstall.packages(\"geosphere\")\ninstall.packages(\"xml2\")\ninstall.packages(\"rvest\")\n\nlibrary(tidyr)\nlibrary(httr)\nlibrary(RCurl)\nlibrary(XML)\nlibrary(bitops)\nlibrary(magrittr)\nlibrary(dplyr)\nlibrary(geosphere)\nlibrary(xml2)\nlibrary(rvest)\n###########################\n######### 抓經緯度 ########\n###########################\n\n\n#address_df <- data.frame(lat = rep(0,length(address)), \n#                         lng = rep(0, length(address)))\n\n########################### 這邊應該要加一個load(total)的指令\n\naddress <- total$address\n#######################12/26 改了起點跟終點 #####################\nstart =10087\nend = 10129\n################################################################\n\ntmp_address <- address[start:end]\nroot = \"http://maps.google.com/maps/api/geocode/\"\nreturn.call = \"xml\"\nsensor = \"false\"\nnum = start\n\n\nfor(each_address in tmp_address){\n  url_gen = paste0(root, return.call, \"?address=\", each_address, \"&sensor=\", sensor)\n  html_code<-read_xml(url_gen)\n  if(xml_text(xml_find_first(html_code,\"//GeocodeResponse//status\"))==\"OK\"){\n    lat=xml_find_first(html_code,\"//result//geometry//location//lat\")%>%xml_text()\n    lng=xml_find_first(html_code,\"//result//geometry//location//lng\")%>%xml_text()\n    loc_type=xml_find_first(html_code,\"//result//geometry//location_type\")%>%xml_text()\n    address_df[num,1] <- lat\n    address_df[num,2] <- lng\n    address_df[num,3] <- loc_type\n  }\n  \n  else if(xml_text(xml_find_first(html_code,\"//GeocodeResponse//status\"))==\"ZERO_RESULTS\"){\n    lat= \"\"\n    lng= \"\"\n    loc_type=\"\"\n    address_df[num,1] <- lat\n    address_df[num,2] <- lng\n    address_df[num,3] <- loc_type\n  }\n  else {\n    print(paste0('error happened in row : ', as.character(num)))\n    break\n  }\n  num = num + 1\n  print(num)\n}\n  \n\nsave(address_df,file = \"2016.12.26.RData\")\n#'total <- cbind(total, address_df)\n#pp591<-filter(total,!grepl(\"~\",address))\n#qq591<-filter(total,grepl(\"~\",address))\n\n################################################################################################\n################################# 算資料與捷運站還有公園的距離 #################################\n################################################################################################\n\n\n#### 這邊應該要加一個load(park)的指令 ###########################(12/26)\n\n#### 我把Fileencoding刪掉了，還有改工作路徑 。###################(12/26)\n#### 超重要！！！！！我改了station_location的名字！##############(12/26)\nstation_location<-read.table(file =\"/Users/nowbird/Documents/各類文件/pq/station_latlng.txt\",header = T,sep = \",\",stringsAsFactors = F)\npark_location <- park[,c(1,6,7)]  ####如果我給你了整理好的park_loaction資料，這行就不需要了\n#################################################################(12/26)\n\naddress_df$lat <- as.numeric(address_df$lat)\naddress_df$lng <- as.numeric(address_df$lng)\npark_location$Latitude <- as.numeric(park_location$Latitude)\npark_location$Longitude <- as.numeric(park_location$Longitude)\n\ndistance_of_station <- data.frame(min_station = rep(0,dim(address_df)[1]),\n                                  min_station_name = rep(0,dim(address_df)[1]),\n                                  min_park = rep(0,dim(address_df)[1]),\n                                  min_park_name = rep(0,dim(address_df)[1]))\n\n\nfor(i in 1:10129){ ######你把起點跟終點改一下，可以繼續往下算最短距離。\n  \n  if(is.na(address_df[i,1]) == T) next\n  \n  temp <- rep(0,dim(station_location)[1])\n  \n  for(j in 1:dim(station_location)[1]){\n    \n    temp[j] <- distCosine(address_df[i,c(2,1)] , station_location[j,c(4,3)])\n    \n  }\n  \n  distance_of_station[i,1] <- min(temp)\n  \n  \n  ################################################################################################\n  ######### 超重要！這邊多寫一個邏輯判斷式，是因為相同最膽距離下，可能會同時存在兩個捷運站，\n  ######### 例如，給定最短距離是500公尺，剛好第一筆資料跟忠孝復興捷運站跟中山國中站的距離都是500\n  ######### 所以這這種情況下，我先把最短捷運站名稱定義成NA，之後再想辦法處理。刪除NA資料時，要避開\n  ######### 此欄位，因為此欄位還是存在最短距離的自變數\n  ################################################################################################\n  \n  \n  if(length(station_location[ temp == min(temp) ,2]) > 1){\n    distance_of_station[i,2] <-NA\n  }else{\n    distance_of_station[i,2] <- station_location[ temp == min(temp) ,2]\n    }\n\n  ################################################################################################\n  \n  temp <- rep(0,dim(park_location)[1])\n  \n  for(j in 1:dim(park_location)[1]){\n    \n    temp[j] <- distCosine(address_df[i,c(2,1)] , park_location[j,c(3,2)])\n    \n  }\n  distance_of_station[i,3] <- min(temp)\n  \n  ###################################################################################################\n  #跟前面同理   #####################################################################################\n  if(length(park_location[ temp == min(temp) ,1]) > 1){\n    distance_of_station[i,4] <-NA\n  }else{\n  distance_of_station[i,4] <- park_location[ temp == min(temp) ,1]}\n  ################################################################################################\n  \n  print(i)\n}\n\n################# 接著把distance_of_station 還有 address_df併在一起就完成了 #####################\n\n#station_loction<-read.table(file =\"/Users/nowbird/Documents/各類文件/pq/station_latlng.txt\",header = T,sep = \",\",stringsAsFactors = F)\n\n\n################12/26 下個步驟是要使用 RAAN套件 #################################################\n\n###############12/26 跑回歸前，要先在total資料中，刪掉 NA的欄位 #################################\n\n###############12/26 大筆資料跑回歸，又是另一個關卡了 ###########################################\n\n",
    "created" : 1482759204371.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "40123870",
    "id" : "BC3E2C5C",
    "lastKnownWriteTime" : 1482756808,
    "last_content_update" : 1482756808,
    "path" : "D:/PecuClass/final_project/AddressToLL.R",
    "project_path" : null,
    "properties" : {
    },
    "relative_order" : 3,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}